<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Start</title>
    <script type="module">
        import * as THREE from './three.module.js';
        import { OBJLoader } from './OBJLoader.js';

        // Log errors to Replit server
        async function logError(error) {
            try {
                await fetch('https://727ef8aa-0a18-4828-95a7-c23ec6d85038-00-1l1livgcuz7dn.spock.replit.dev/log', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ error: error })
                });
            } catch (e) {
                console.error("Failed to log error:", e);
            }
        }

        // Scene setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Add lights
        const ambientLight = new THREE.AmbientLight(0x404040); // soft white light
        const pointLight = new THREE.PointLight(0xffffff, 1, 100);
        pointLight.position.set(50, 50, 50);
        scene.add(ambientLight);
        scene.add(pointLight);

        // Load floor and player models
        const loader = new OBJLoader();
        let player, floor;

        function loadModels() {
            loader.load('floor.obj', (object) => {
                floor = object;
                scene.add(floor);
            }, undefined, (error) => {
                console.error('Error loading floor model:', error);
                logError('Error loading floor model: ' + error);
            });

            loader.load('player.obj', (object) => {
                player = object;
                scene.add(player);
                player.position.set(0, 0, 0); // Place the player on the floor
            }, undefined, (error) => {
                console.error('Error loading player model:', error);
                logError('Error loading player model: ' + error);
            });
        }

        // Joystick setup (add your joystick logic here)
        function setupJoysticks() {
            // Code for joystick setup goes here
            console.log('Joysticks initialized'); // Temporary log for testing
        }

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            if (player) {
                player.rotation.y += 0.01; // Example rotation, adjust as needed
            }
            renderer.render(scene, camera);
        }

        // Initialize
        function init() {
            loadModels();
            setupJoysticks();
            animate();
        }

        window.onload = init;
    </script>
</head>
<body>
</body>
</html>
